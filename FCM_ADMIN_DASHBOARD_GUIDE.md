# 🔥 FCM 관리자 대시보드 사용 가이드

## 개요
ADMIN 전용 FCM 관리자 대시보드는 Firebase Cloud Messaging을 통해 푸시 알림을 관리하고 모니터링할 수 있는 전용 페이지입니다.

## 접근 방법

### 1. 로그인
- ADMIN 권한이 있는 계정으로 로그인
- 사용 가능한 ADMIN 계정: `admin`, `ROD`

### 2. 대시보드 접근
- 메인 페이지 헤더의 **🔥 FCM 관리** 버튼 클릭
- 또는 직접 URL 접근: `/fcm-admin-dashboard`

## 주요 기능

### 📊 FCM 통계 대시보드
- **총 등록 토큰**: 시스템에 등록된 모든 FCM 토큰 수
- **활성 토큰**: 현재 활성 상태인 토큰 수
- **등록 사용자**: FCM 토큰을 등록한 사용자 수
- **오늘 등록**: 오늘 새로 등록된 토큰 수

### 📱 FCM 토큰 관리
- **토큰 등록**: 새로운 FCM 토큰을 시스템에 등록
- **토큰 제거**: 등록된 FCM 토큰을 시스템에서 제거
- **모든 토큰 조회**: 시스템에 등록된 모든 토큰 정보 확인

### 📢 푸시 알림 전송
- **모든 등록된 기기**: 모든 등록된 기기로 알림 전송
- **테스트 알람**: 관리자만 테스트 알람 전송
- **사용자 지정**: 특정 사용자들에게만 알림 전송

### 📱 등록된 기기 목록
- 사용자 ID, FCM 토큰, 기기 정보, 등록일, 마지막 사용, 상태 등 상세 정보
- 개별 토큰 제거 기능
- 실시간 상태 모니터링

### 🧹 토큰 정리 및 유지보수
- **비활성 토큰 정리**: 지정된 기간 동안 사용되지 않은 토큰 자동 정리
- **토큰 데이터 내보내기**: JSON 형태로 토큰 데이터 다운로드

## 사용 방법

### 1. FCM 토큰 등록
```
1. FCM 토큰 입력 필드에 토큰 입력
2. 기기 정보 입력 (선택사항)
3. "✅ 토큰 등록" 버튼 클릭
```

### 2. 푸시 알림 전송
```
1. 알림 제목 입력
2. 알림 내용 입력
3. 전송 대상 선택
   - 모든 등록된 기기
   - 테스트 알람 (관리자만)
   - 사용자 지정 (사용자 ID 입력)
4. "🚀 알림 전송" 버튼 클릭
```

### 3. 테스트 알람 전송
```
1. 전송 대상을 "테스트 알람 (관리자만)" 선택
2. 알림 제목과 내용 입력
3. 전송 버튼 클릭
4. 관리자 계정으로 등록된 기기에만 테스트 알람 전송
```

### 4. 비활성 토큰 정리
```
1. 정리 기준 일수 설정 (기본값: 30일)
2. "🧹 비활성 토큰 정리" 버튼 클릭
3. 확인 대화상자에서 "확인" 클릭
4. 지정된 기간 동안 사용되지 않은 토큰 자동 정리
```

## 보안 및 권한

### 접근 제한
- ADMIN 역할을 가진 사용자만 접근 가능
- 일반 사용자는 접근 시도 시 메인 페이지로 리다이렉트

### API 보안
- 모든 FCM API 엔드포인트는 로그인 필요
- 관리자 전용 기능은 추가 권한 검증

## 모니터링 및 로깅

### 접속 로그
- 관리자 대시보드 접속 시 자동으로 접속 로그 기록
- 사용자 정보, 역할, 접속 시간 등 상세 정보 저장

### 오류 처리
- 모든 작업 결과를 실시간으로 표시
- 성공/실패/정보 메시지를 색상으로 구분
- 5초 후 자동으로 메시지 숨김

## 문제 해결

### 일반적인 문제
1. **토큰 등록 실패**
   - FCM 토큰 형식 확인
   - 네트워크 연결 상태 확인
   - 서버 로그 확인

2. **알림 전송 실패**
   - 등록된 토큰 존재 여부 확인
   - Firebase 서비스 계정 설정 확인
   - 알림 내용 길이 제한 확인

3. **권한 오류**
   - 사용자 역할이 ADMIN인지 확인
   - 세션 만료 여부 확인
   - 재로그인 시도

### 로그 확인
- 서버 콘솔에서 FCM 관련 로그 확인
- 브라우저 개발자 도구에서 네트워크 요청 확인
- API 응답 상태 코드 및 메시지 확인

## 기술적 세부사항

### 백엔드 API
- `/api/fcm/register-token`: 토큰 등록
- `/api/fcm/unregister-token`: 토큰 제거
- `/api/fcm/send-notification`: 알림 전송
- `/api/fcm/stats`: 통계 조회
- `/api/fcm/cleanup`: 토큰 정리

### 데이터 저장
- FCM 토큰은 `data/fcm_tokens.json` 파일에 저장
- 사용자별로 토큰 그룹화
- 등록일, 마지막 사용, 활성 상태 등 메타데이터 포함

### 실시간 업데이트
- 통계 및 기기 목록 자동 새로고침
- 새로고침 버튼으로 수동 업데이트 가능
- 작업 완료 후 자동으로 데이터 갱신

## 향후 개선사항

### 계획된 기능
- 실시간 웹소켓 연결로 실시간 상태 업데이트
- 알림 전송 히스토리 및 통계
- 사용자별 알림 전송 권한 관리
- 알림 템플릿 관리 시스템
- 대량 알림 전송 스케줄링

### 성능 최적화
- 토큰 데이터베이스 인덱싱
- 캐싱 시스템 도입
- 비동기 알림 전송 처리
- 메모리 사용량 최적화

## 지원 및 문의

### 기술 지원
- 서버 로그 확인
- Firebase 콘솔 설정 확인
- 네트워크 연결 상태 확인

### 문서 참조
- `FCM_USAGE.md`: 전체 FCM 시스템 사용법
- `API_USAGE.md`: API 사용법 및 예제
- `INTERNAL_DEPLOYMENT.md`: 내부 서버 배포 가이드

---

**⚠️ 주의사항**: 이 대시보드는 ADMIN 권한을 가진 사용자만 접근할 수 있습니다. 일반 사용자에게는 표시되지 않으며, 접근 시도 시 보안상의 이유로 차단됩니다.
